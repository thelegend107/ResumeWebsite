-- use database
USE [datawarehouse];
GO

-- Drop tables if exists
IF OBJECT_ID(N'dbo.Cities', N'U') IS NOT NULL  
   DROP TABLE [dbo].[Cities];
GO

IF OBJECT_ID(N'dbo.States', N'U') IS NOT NULL  
   DROP TABLE [dbo].[States];
GO

IF OBJECT_ID(N'dbo.Countries', N'U') IS NOT NULL  
   DROP TABLE [dbo].[Countries];
GO

IF OBJECT_ID(N'dbo.SubRegions', N'U') IS NOT NULL  
   DROP TABLE [dbo].[SubRegions];
GO

IF OBJECT_ID(N'dbo.Regions', N'U') IS NOT NULL  
   DROP TABLE [dbo].[Regions];
GO

-- Create tables
CREATE TABLE Regions (
    Id INT IDENTITY(1, 1) NOT NULL CONSTRAINT pk_Regions PRIMARY KEY CLUSTERED,
	Name NVARCHAR(50) NOT NULL
);
GO

CREATE TABLE SubRegions (
	Id INT IDENTITY(1, 1) NOT NULL CONSTRAINT pk_SubRegions PRIMARY KEY CLUSTERED,
	RegionId INT CONSTRAINT fk_Regions_SubRegions FOREIGN KEY REFERENCES Regions(Id) ON DELETE CASCADE ON UPDATE CASCADE,
	Name NVARCHAR(50) NOT NULL
);
GO

CREATE TABLE Countries (
	Id INT IDENTITY(1, 1) NOT NULL CONSTRAINT pk_Countries PRIMARY KEY CLUSTERED,
	RegionId INT NULL CONSTRAINT fk_Regions_Countries FOREIGN KEY REFERENCES Regions(Id),
	SubRegionId INT NULL CONSTRAINT fk_SubRegions_Countries FOREIGN KEY REFERENCES SubRegions(Id) ON DELETE CASCADE ON UPDATE CASCADE,
	Name NVARCHAR(50) NOT NULL,
	NativeName NVARCHAR(100) NULL,
	ISO3 NVARCHAR(3) NOT NULL,
	ISO2 NVARCHAR(2) NOT NULL,
	NumericCode int NOT NULL,
	PhoneCode NVARCHAR(50) NOT NULL,
	Capital NVARCHAR(50) NULL,
	Currency NVARCHAR(50) NOT NULL,
	CurrencyName NVARCHAR(50) NOT NULL,
	CurrencySymbol NVARCHAR(50) NOT NULL,
	Tld NVARCHAR(50) NOT NULL,
	Latitude FLOAT NULL,
	Longitude FLOAT NULL,
	Emoji NVARCHAR(50)
);
GO

CREATE TABLE States (
	Id INT IDENTITY(1, 1) NOT NULL CONSTRAINT pk_States PRIMARY KEY CLUSTERED,
	CountryId INT NOT NULL CONSTRAINT fk_Countries_States FOREIGN KEY REFERENCES Countries(Id) ON DELETE CASCADE ON UPDATE CASCADE,
	StateCode NVARCHAR(50) NOT NULL,
	Name NVARCHAR(50) NOT NULL,
	Latitude FLOAT NULL,
	Longitude FLOAT NULL
);
GO

CREATE TABLE Cities (
	Id INT IDENTITY(1, 1) NOT NULL CONSTRAINT pk_Cities PRIMARY KEY CLUSTERED,
	CountryId INT NOT NULL CONSTRAINT fk_Countries_Cities FOREIGN KEY REFERENCES Countries(Id),
	StateId INT NOT NULL CONSTRAINT fk_States_Cities FOREIGN KEY REFERENCES States(Id) ON DELETE CASCADE ON UPDATE CASCADE,
	Name NVARCHAR(50) NOT NULL,
	Latitude FLOAT NULL,
	Longitude FLOAT NULL
);
GO